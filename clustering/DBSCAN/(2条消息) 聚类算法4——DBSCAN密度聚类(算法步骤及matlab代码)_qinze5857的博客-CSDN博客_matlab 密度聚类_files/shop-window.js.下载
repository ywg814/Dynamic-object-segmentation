"use strict";!function(){function n(){return!!window.navigator.userAgent.toLowerCase().match(/(phone|pad|pod|iphone|ipod|ios|ipad|android|mobile|blackberry|iemobile|mqqbrowser|juc|fennec|wosbrowser|browserng|webos|symbian|windows phone)/i)}function s(){return!!window.navigator.userAgent.toLowerCase().match(/(csdn)/i)}function e(){return/(?:android)/.test(window.navigator.userAgent.toLowerCase())}function t(){return window.csdn&&window.csdn.toolbarIsBlack}function o(n){var s=document.createElement("link");s.rel="stylesheet",s.type="text/css",s.href=n,document.getElementsByTagName("head")[0].appendChild(s)}function i(){var n=window.location.hostname;return n.indexOf("test")>=0||n.indexOf("loc")>=0?"test":n.indexOf("pre")>=0?"pre":"prod"}function a(){return v[i()].mallUrl}function d(n){var s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e="";for(var t in n)"function"!=typeof n[t]&&(e+=t+"="+(n[t]||"")+"&");return void 0,e=e.substr(0,e.length-1),(s?"?":"&")+e}function c(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=t.path||"";if(delete t.path,s()){var i=""+f+d(t,!1)+g.app[o];e()?window.jsCallBackListener&&window.jsCallBackListener.csdnjumpnewpage(JSON.stringify({url:i})):window.webkit&&window.webkit.messageHandlers.csdnjumpnewpage.postMessage(JSON.stringify({url:i}))}else n()?window.location.href=""+a()+g.wap[o]+d(t):window.location.href=a()+"/item/"+t.skuId}function r(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{path:"",skuId:"",keyword:"",cat1:"",cat2:"",ca3:""},s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return s&&-1===s.indexOf("mall.csdn.net/item")?void(window.location.href=s):n.path?g.app[n.path]?void c(n):void void 0:void void 0}function p(n,s){void 0,e()?window.jsCallBackListener&&window.jsCallBackListener.csdnapptrack(n,JSON.stringify(s)):window.webkit&&window.webkit.messageHandlers.csdnapptrack.postMessage([n,JSON.stringify(s)])}function w(n){p("w_blog_shopwindow_expo",{name:window.username,goods_name:n})}function l(n){var s=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,e=n.getBoundingClientRect()&&n.getBoundingClientRect().top;return void 0,e<=s+100}function h(n,e){if(s()&&n){var t=null,o=!1;void 0;try{var i=new IntersectionObserver(function(n){n[0].intersectionRatio>=.6&&(void 0,w(e),i.disconnect())},{threshold:[0,.66,1]});i.observe(n)}catch(s){void 0,l(n)?(void 0,w(e),o=!0):(void 0,$(document).scroll(function(s){t&&clearTimeout(t),o||(t=setTimeout(function(){l(n)&&(w(e),o=!0)},100))}))}}}function m(n){e()?window.jsCallBackListener&&window.jsCallBackListener.csdnjumpnewpage(JSON.stringify({url:n})):window.webkit&&window.webkit.messageHandlers.csdnjumpnewpage.postMessage(JSON.stringify({url:n}))}function u(){this.env=i(),this.isDark=t(),this.isApp=s(),this.userName=window.username,this.container=$("#csdn-shop-window"),this.cssLink=v[this.env].cssLink,this.hostUrl=v[this.env].hostUrl,this.h5Url=v[this.env].h5Url,this.adminUrl=v[this.env].adminUrl,this.init()}var g={app:{detail:"&path=pages/item/detail",search:"&path=pages/search/index",list:"&path=pages/search/list",catagory:"&path=pages/catagory/index",cart:"&path=pages/cart/list"},wap:{detail:"/pages/item/detail",search:"/pages/search/index",list:"/pages/search/list",catagory:"/pages/catagory/index",cart:"/pages/cart/list "}},f="csdnapp://app.csdn.net/mpTinyApp?id=__UNI__1117CC5",v={test:{hostUrl:"http://test-blog-web.csdn.net",h5Url:"https://test-cms-mall.csdn.net/p/181",cssLink:"../demo/shop-window.css",mallUrl:"https://test-mall.csdn.net",adminUrl:"https://test-mp.csdn.net/console/MyShop"},pre:{hostUrl:"https://pre-blog-web.csdn.net",h5Url:"https://mall.csdn.net/min-shop",cssLink:"https://g.csdnimg.cn/common/shop-window/shop-window.css",mallUrl:"https://mall.csdn.net",adminUrl:"https://test-mp.csdn.net/console/MyShop"},prod:{hostUrl:"https://blog.csdn.net",h5Url:"https://mall.csdn.net/min-shop",cssLink:"https://g.csdnimg.cn/common/shop-window/shop-window.css",mallUrl:"https://mall.csdn.net",adminUrl:"https://mp.csdn.net/console/MyShop"}};u.prototype.init=function(){(this.userName||(void 0,"test"===this.env))&&(o(this.cssLink),this.getDataByUserName(this.render))},u.prototype.render=function(s){if(0!==this.container.length&&0!==s.items.length){var e=n()?this.getWapHtml(s):this.getPcHtml(s),t=this;this.container.append(e),this.container.find(".csdn-shop-window-item").click(function(n){var s=$(this).attr("data-name");t.isApp?p("w_blog_shopwindow_click",{pagename:"商品",name:t.userName,goods_name:s}):window.csdn.report&&window.csdn.report.reportClick({spm:"3001.5756"});var e=$(this).attr("data-id");e&&r({path:"detail",skuId:e})}),this.container.find(".csdn-shop-window-link").click(function(n){var e=t.isApp?t.h5Url+"?username="+t.userName:"https://blog.csdn.net/"+t.userName+"?type=shop";t.isApp?(p("w_blog_shopwindow_click",{pagename:"查看全部商品",name:t.userName,goods_name:s.goodsName}),m(e)):(window.csdn.report&&window.csdn.report.reportClick({spm:"3001.5758"}),window.location.href=e)}),setTimeout(function(){h(t.container[0],s.goodsName.toString())},200)}},u.prototype.getPcHtml=function(n){var s=this;return"<div "+(s.isApp?"":'data-report-view=\'{"spm": "3001.5787"}\'')+' class="csdn-shop-window csdn-shop-window-pc '+(s.isDark?"csdn-shop-window-dark":"")+'">\n              <h5 class="csdn-shop-window-head">\n                <span title="'+n.shopWindowName+'" class="csdn-shop-window-title"><i></i>'+n.shopWindowName+"</span>\n                "+(n.shopWindowDesc?'<span class="csdn-shop-window-desc"><i></i>'+n.shopWindowDesc+"</span>":"")+'\n                <a class="csdn-shop-window-link shop-window-need-show" href="javascript:;"><i></i>更多</a>\n                <a data-report-click=\'{"spm": "3001.5757"}\' class="csdn-shop-window-open" href="'+s.adminUrl+'">我也想开通小店</a>\n              </h5>\n              <div class="csdn-shop-window-body">\n                '+n.items.map(function(n){return s.getPcItem(n)}).join("")+'\n                <a class="csdn-shop-window-link shop-window-need-hide" href="javascript:;"><i></i><span>更多</span></a>\n              </div>\n            </div>'},u.prototype.getWapHtml=function(n){var s=this;return"<div "+(s.isApp?"":'data-report-view=\'{"spm": "3001.5787"}\'')+' class="csdn-shop-window csdn-shop-window-wap '+(s.isDark?"csdn-shop-window-dark":"")+'">\n              <div class="csdn-shop-window-head">\n                '+n.shopWindowName+'\n                <a class="csdn-shop-window-link" href="javascript:;" >更多<i></i></a>\n              </div>\n              <div class="csdn-shop-window-body">\n                '+n.items.map(function(n){return s.getWapItem(n)}).join("")+"\n              </div>\n            </div>"},u.prototype.getPcItem=function(n){return'<a class="csdn-shop-window-item" data-id="'+n.itemId+'" data-name="'+n.itemName+'" href="javascript:;">\n              <img src="'+n.itemPic+'" alt="">\n              <div class="csdn-shop-window-item-content">\n                <h6 title="'+n.itemName+'">'+n.itemName+'</h6>\n                <p class="csdn-shop-window-item-info">\n                  <span><em title="'+n.owner+'">作者：'+n.author+'</em></span>\n                  <span><em title="'+n.source+'">出版社：'+n.press+'</em></span>\n                </p>\n                <p class="csdn-shop-window-price-info">\n                  <span class="shop-window-need-hide"><em>好评：'+n.CommentRate+"</em></span>\n                  <span><em>销售量："+n.salesVolume+"</em></span>\n                  <i>￥"+n.price+"</i>\n                </p>\n              </div>\n            </a>"},u.prototype.getWapItem=function(n){return'<div class="csdn-shop-window-item" data-id="'+n.itemId+'" data-name="'+n.itemName+'">\n                <img src="'+n.itemPic+'" alt="">                \n                <div class="csdn-shop-window-item-content">\n                  <p class="csdn-shop-window-item-name">'+n.itemName+'</p>\n                  <p class="csdn-shop-window-item-autor">作者：'+n.author+'</p>\n                  <p class="csdn-shop-window-item-origin">出版社：'+n.press+'</p>\n                  <p class="csdn-shop-window-item-info">\n                    <span>好评：'+n.CommentRate+'</span>\n                    <span class="csdn-shop-window-item-info-num">销量：'+n.salesVolume+'</span>\n                    <span class="csdn-shop-window-item-info-price">￥'+n.price+"</span>\n                  </p>\n                </div>\n            </div>"},u.prototype.getDataByUserName=function(n){var e=this,t=e.hostUrl+"/phoenix/web/v1/get-shop-window-goods-list";s()&&(t="https://mall.csdn.net/mp/mall/api/shopWindow/goodsList"),$.ajax({url:t,type:"get",xhrFields:{withCredentials:!0},data:{username:e.userName},dataType:"json",success:function(s){if(200===s.code){var t=s.data.reduce(function(n,s){return s.author=s.author||"暂无",s.press=s.press||"暂无",n.shopWindowDesc=s.shopWindowDesc,n.shopWindowName=window.nickName+"的小店橱窗",n.items=n.items.concat(s),n.goodsName=n.goodsName.concat(s.itemName),n},{shopWindowDesc:"",shopWindowName:"小店橱窗",items:[],goodsName:[]});void 0,n&&"function"==typeof n&&n.call(e,t)}},error:function(n){void 0}})},$(function(){$.ajax({url:"https://img-home.csdnimg.cn/data_json/jsconfig/shop-window-new.json",type:"get",dataType:"JSON",contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(n){n&&(v=n),window.blogShopInIt||new u},error:function(n){}})})}();